# Alarm clock documentation
# The display normally shows the time anf has 9 alternative displays
# Line 0: Time
# Line 1: Environment
# Line 2: Sunday
# Line 8: Saturday
# Line 9: IP number
# Switch to the next line by pressing the display (right) button repeatedly. The brightness of display and leds is
#        adapted to the surroundings.
#
# On/Off functions dependent on the line, at lines 0,1,9 it switches the display and leds on/off
#        on lines 2-8 it turns the alarm on/off. Doubleclick sets the alarm once
#        The red led will light up if the alarm is on and the amber led will light up if the alarm is set once.
#        In the time display the red led will light up if an alarm within 24 hours is set.
# Up/Down functions dependent on the line, at lines 0,1,9 it toggles a HA visible binary sensor (e.g. to control lights)
#         Alt lines 2-8 it increases/decreases the alarm time by 5 min. Hold for continuous action
#
# The alarm clock exposes several settings and sensors in HA and the web interface
# - Button
#   - Turn all alarms off Switches off all alarms
#   - Turn on weekdays   Turns on all alarms set on weekdays
# - Switch
#   - Alarm              Is turned on when alarm sounds; can be turned on from HA as well.
#                        Alarm can be turned of by pressing any button
#   - Buzzer with alarm  Sounds melody when the alarm goes off. No alarm sound when tuned off 
#                        e.g. so HA can switch on remote speaker or Sonos
#                        Note: The buzzer will sound always when there is no connection to HA.
#   - Alert now          Sound a siren directly when turn on. e.g. for fire or burglar alarm    
#   - Turn on at         Switch to turn on display at a set time
#   - Turn off at        Switch to turn off display at a set time
#   - Up/Down toggles display The up/down button toggles the display instead of toggling a binary sensor in HA
#   - Message            Turn on/off the message led/dot
#
# - Number
#   - Alarm timeout      Number of minutes afther which the alarm should stop
#   - Display timeout    Number of seconds after which the display must return to tome display
#   - Maximum brightness Number of Lux above this the display shoule me at max brightness
#   - Minimum brightness Number of lux below which the display must be at minimum brightness
#                        Note: Amber and blue led brightness is connected to display brightness
#   - TVOC warning       At which ppb value the orange led will be switched on
#   - Turn display on before Turn display set minutes on before the set alarm (0 to disable)
#   - Turn display off after Turn display off minutes after alarm went off (0 to disable)
#
# - Sensor
#   - Sensors from CCS811 Air quality sensors tvoc and eco2
#   - Sensors from BMP085 Pressure and temperature
#   - Sensor from LH1750 Illuminance in lux
#   - Two binary sensors representing the up and down buttons
#   - Status & network sensors
#   - Sensor containing next alarm countdown in minutes for this or the next day (max 2880 minutes)
#
# BEFORE DEPLOYING THE ALARM CLOCK
# - Set hide_button_sensor to false and upload the firmware
#   Now press the buttons and observe the voltage values (Sensor bButton volt)
#   Use the readings to update the voltage values for the buttons. Create as wide a margin as
#   possible, 0.2V to 0.3V above and below the detected value. No overlap between the buttons is allowed
# - Set baseline to an empty value and run the alarmclock outside or in a well ventilated room to
#   calibrate the CSS811 sensor. After a few hours the the baseline value from the logs and enter it below

substitutions:
  # Set below subtitutions to 0 and false for upright and 180 andn true for upside down
  chip_orient: "0"
  reverse_enable: "false"
  # Buzzer tunes. Melody is played for waking up, siren is for Alert Now
  melody: "mario:d=4,o=5,b=100:16e6,16e6,32p,8e6,16c6,8e6,8g6,8p,8g,8p,8c6,16p,8g,16p,8e,16p,8a,8b,16a#,8a,16g.,16e6,16g6,8a6,16f6,8g6,8e6,16c6,16d6,8b,16p,8c6,16p,8g,16p,8e,16p,8a,8b,16a#,8a,16g.,16e6,16g6,8a6,16f6,8g6,8e6,16c6,16d6,8b,8p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,16g#,16a,16c6,16p,16a,16c6,16d6,8p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,16c7,16p,16c7,16c7,p,16g6,16f#6,16f6,16d#6,16p,16e6,16p,16g#,16a,16c6,16p,16a,16c6,16d6,8p,16d#6,8p,16d6,8p,16c6"
  siren: "siren:d=8,o=5,b=100:d,e,d,e,d,e,d,e"
  # Voltage values for the buttons
  # To determine what the proper voltages are, set "hide_button_sensor" to false. This creates a voltage
  # sensor with which you can detect the proper voltage for each button.
  hide_button_sensor: "True"
  display_min: "0.95"
  display_max: "1.30"
  onoff_min: "1.40"
  onoff_max: "2.00"
  up_min: "0.73"
  up_max: "0.90"
  down_min: "0.50"
  down_max: "0.73"
  # CSS811 Baseline
  # Comment out on first run. After a few hours you can see the proper baseline in the ESP logs
  # use that value here
  baseline: "0x21C6"
  # Sensor in HA containing the outdoor temperature
  outdoor_temp_sensor: "sensor.gw2000a_outdoor_temperature"
  # Weekdays: Update for your translation
  weekdays: "SuMoTuWeThFrSa"
  # LED GPIO pins 
  redledpin: "GPIO25"
  ambledpin: "GPIO26"
  bluledpin: "GPIO27"
  # Buzzer GPIO pin
  buzzerpin: "GPIO32"
  # I2C pins
  i2csdapin: "GPIO21"
  i2csclpin: "GPIO22"
  # SPI pins
  spiclkpin: "GPIO18"
  spimospin: "GPIO23"
  dispcspin: "5"
  # Button ADC pin
  buttonpin: "GPIO33"
  # NTP server
  # Set to an internet time source to make sure the alarm clock functions properly when HA is down
  ntpserver: "nl.pool.ntp.org"

esphome:
  name: alarm-clock
  friendly_name: "Alarm Clock"
  min_version: 2024.6.0
  project: 
    name: "lancer73.alarm_clock"
    version: "1.0.0"

# Adapt this to you specific controller
# If you are not using an ESP32 DevkitC v4
esp32:
  board: esp32dev
  cpu_frequency: 240MHz
  framework:
    type: esp-idf
    advanced:
      minimum_chip_revision: "3.1"

# Enable Home Assistant API
api:
  encryption:
    key: !secret [YOURAPIENCRYPTIONKEY]
    
ota:
  platform: esphome
  password: !secret [YOUROTAPASSWORD]

# Enable logging
logger:
    level: DEBUG
    logs: 
      sensor: INFO
      max7219DIGIT: INFO
      light: INFO
      datetime.time_entity: INFO
      switch: INFO
      text_sensor: INFO
      binary_sensor: INFO
      button: INFO

wifi:
  networks:
  - ssid: !secret wifi_ssid
    password: !secret wifi_password
  reboot_timeout: 30min
  min_auth_mode: wpa2
# Uncomment the lines below for a fallback hotspot
  ap:
    ssid: "Alarm Clock Hotspot"
    password: !secret [YOURAPIPASSWORD]

# Enable IPv6. 
network:
  enable_ipv6: true

# Enable fallback hotspot (captive portal) in case wifi connection fails
captive_portal:

# Enable the webserver and create groups for the dashboard
# The webserver is for control purposes. No OTA and no LOG
# Run fully local.
web_server:
  auth:
    username: !secret [YOURWEBACCOUNT]
    password: !secret [YOURWEBPASSWORD]
  ota: False
  log: False

# Comment out these sensors if you have connected the environmental sensors
# Uncomment them if you do not have the environmental sensors
#sensor:
#  - platform: template
#    id: temperature
#    lambda: return 0.0;
#    internal: True
#  - platform: template
#    id: tvoc
#    lambda: return 0.0;
#    internal: True

# Comment out the leds and/or the environment package when you don't
# have the leds or the environmental sensors
packages:
  remote_package_files:
    url: https://github.com/lancer73/ESPHome-Alarm-Clock
    files:
      - path: alarmclock_includes/alarmclock_base.yaml
      - path: alarmclock_includes/alarmclock_leds.yaml
      - path: alarmclock_includes/alarmclock_environment.yaml
    ref: "main"
    refresh: 1d
